!function(e){var t={};function o(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=t,o.d=function(e,t,r){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(o.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)o.d(r,n,function(t){return e[t]}.bind(null,n));return r},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t){var o=[[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,6,6,6,0,0],[0,0,0,0,0,0,6,0,0,0],[0,0,5,0,0,0,0,0,0,0],[0,0,5,0,0,0,0,0,0,0],[0,5,5,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0],[3,0,0,0,0,0,0,7,7,0],[3,0,0,0,0,0,0,7,7,0],[3,1,0,2,0,0,0,0,0,0],[3,1,0,2,2,4,4,0,0,0],[1,1,1,2,2,4,4,0,0,0],[1,6,6,2,2,4,4,0,0,1]],r=!1,n=null;function l(){if(r)return document.removeEventListener("keydown",i),void h.removeEventListener("mousedown",a);f.globalAlpha=1,f.fillStyle="black",f.fillRect(0,0,h.width,h.height),I(o,{x:0,y:0}),Math.round(v.y/c)>9&&Math.ceil(v.y/c)<13?(f.fillStyle="gray",f.globalAlpha=.2,f.fillRect(0,v.y-c/2,h.width,c),n=Math.round(v.y/c)-10):n=null,f.globalAlpha=1,f.fillStyle="white",f.font=c+"px monospace",f.fillText("> New Game",2*c,10*c),f.fillText("> Continue",2*c,11*c),f.fillText("> Info",2*c,12*c),requestAnimationFrame(l)}function i(){F()}function a(){switch(n){case 0:U(),F(),x&&(location.reload(),U(),F());break;case 1:F();break;case 2:window.open("https://chrome.google.com/webstore/detail/popup-tetrys/bnchicpgbdgahiecgofdabidjihblaff","_blank")}}window.onload=function(){h=document.getElementById("canvas"),f=h.getContext("2d"),c=h.width/10,document.addEventListener("mousemove",R),document.addEventListener("keydown",i),h.addEventListener("mousedown",a),void 0===localStorage._scoreResetSept2018&&(localStorage._hscore=d=0,localStorage._scoreResetSept2018=!0),requestAnimationFrame(l)};const s=[null,"#FF0D72","#0DC2FF","#0DFF72","#F538FF","#FF8E0D","#FFE138","#3877FF"];shapes=[[[1,1,1],[0,1,0],[0,0,0]],[[2,2],[2,2]],[[0,0,3,0],[0,0,3,0],[0,0,3,0],[0,0,3,0]],[[0,4,0],[0,4,0],[0,4,4]],[[0,5,0],[0,5,0],[5,5,0]],[[0,6,6],[6,6,0],[0,0,0]],[[7,7,0],[0,7,7],[0,0,0]]],speed=7;let f,h,c,u,d,g,y,p,S=0,x=!1,v={x:0,y:0},m=!1,w=!1,b=12,_=20,k=1,O=0;function F(){clearInterval(e),clearInterval(t);try{document.removeEventListener("keydown",te),document.removeEventListener("keyup",te),document.removeEventListener("mousedown",j)}catch(e){console.error(e)}r=!0,document.addEventListener("keydown",te),document.addEventListener("keyup",te),document.addEventListener("mousedown",j);try{x=JSON.parse(localStorage._end)}catch(e){console.error(e),x=!1}try{!function(){try{if(x)return d=JSON.parse(localStorage._hscore),u=J(h.width/c,h.height/c).slice(0),B(),void(x=!1)}catch(e){console.error(e),d=0}try{null!=localStorage._arena&&"undefined"!=localStorage._arena&&(u=JSON.parse(localStorage._arena))}catch(e){console.error(e)}finally{null==u&&(u=J(h.width/c,h.height/c))}try{null==localStorage._hscore||"undefined"==localStorage._hscore?highScore=localStorage._hscore=0:highScore=JSON.parse(localStorage._hscore),S=null==localStorage._score||"undefined"==localStorage._score?localStorage._score=0:JSON.parse(localStorage._score),P=JSON.parse(localStorage._player)}catch(e){console.error(e)}}()}catch(e){console.error(e)}(g=new Image).src="../images/restart.png",(y=new Image).src="../images/pause.png";var e=setInterval($,1e3/_),t=setInterval(ee,1e3/b);null==P&&B(),requestAnimationFrame(N)}let T=0,z=0,E=0,A=50*speed;function N(e=0){if(x&&function(){let e="You hit the limit!",t=.05*c;f.font=c+"px Arial",f.fillStyle="#ff5b5b",f.fillText(e,h.width/2-f.measureText(e).width/2+t,8*c+t);let o="Press any key to restart";f.font=.7*c+"px Arial",f.fillStyle="#ff5b5b",f.fillText(o,h.width/2-f.measureText(o).width/2+t,9*c+t),f.font=c+"px Arial",f.fillStyle="red",f.fillText(e,h.width/2-f.measureText(e).width/2,8*c),f.font=.7*c+"px Arial",f.fillStyle="red",f.fillText(o,h.width/2-f.measureText(o).width/2,9*c)}(),f.fillStyle="black",f.fillRect(0,0,h.width,h.height),f.fillStyle="red",f.fillRect(0,3*c-k,h.width,k),I(u,{x:0,y:0}),I(P.shape,{x:P.x,y:P.y}),M(),T=e-z,z=e,(E+=T)>A&&!x&&!w&&(D(),E=0),null==d)try{d=localStorage._hscore}catch(e){console.error(e)}null==d&&(d=0),f.font=2*c+"px Arial",f.fillStyle="#fff",f.fillText(S,h.width/2-f.measureText(S).width/2,2.5*c),f.font=.5*c+"px Arial",f.fillStyle="#fff",f.fillText("High score: "+d,h.width/2-f.measureText("High score: "+d).width/2,3.5*c),function(){this.offset=1,this.hoverSize=c/5,v.x>c*this.offset-this.hoverSize&&v.x<c*this.offset+c+2*this.hoverSize&&v.y>c*this.offset-this.hoverSize&&v.y<c*this.offset+c+2*this.hoverSize?(m=!0,f.fillStyle="#3a3a3a",f.fillRect(c*this.offset-this.hoverSize,c*this.offset-this.hoverSize,c+2*this.hoverSize,c+2*this.hoverSize)):m=!1;f.drawImage(g,c*this.offset,c*this.offset,c,c)}(),function(){this.offsetX=8,this.offsetY=1,this.hoverSize=c/5,v.x>c*this.offsetX-this.hoverSize&&v.x<c*this.offsetX+c+offsetX&&v.y>c*this.offsetY-this.hoverSize&&v.y<c*this.offsetY+c+offsetY?(p=!0,f.fillStyle="#3a3a3a",f.fillRect(c*this.offsetX-this.hoverSize,c*this.offsetY-this.hoverSize,c+2*this.hoverSize,c+2*this.hoverSize)):p=!1;f.drawImage(y,c*this.offsetX,c*this.offsetY,c,c)}(),function(){for(let e=u.length-1;e>=0;e--)u[e].every(e=>e>0)&&(u.splice(e,1),u.splice(0,0,new Array(u[1].length).fill(0)),S+=O,O*=2)}(),requestAnimationFrame(N)}function J(e,t){let o=[];for(;t--;)o.push(new Array(e).fill(0));return o}function I(e,t){for(let o=0;o<e.length;o++)for(let r=0;r<e[o].length;r++)0!==e[o][r]&&(f.fillStyle=s[e[o][r]],f.fillRect((t.x+r)*c,(t.y+o)*c,c,c))}function L(e,t){for(let t=0;t<e.length;++t)for(let o=0;o<t;++o)[e[o][t],e[t][o]]=[e[t][o],e[o][t]];t>0?e.forEach(e=>e.reverse()):e.reverse()}function M(){try{S>d&&(d=S,localStorage._hscore=JSON.stringify(d)),localStorage._end=JSON.stringify(x),localStorage._score=JSON.stringify(S),localStorage._arena=JSON.stringify(u),localStorage._player=JSON.stringify(P)}catch(e){}}function R(e){const t=window.getComputedStyle(h),o=parseInt(t.width),r=parseInt(t.height),n=h.width/o,l=h.height/r;let i=h.getBoundingClientRect();v.x=(e.clientX-i.left)*n,v.y=(e.clientY-i.top)*l}function j(e){m?U(!0):p&&(w=!w)}var Y=1,C=10,X=75,P={start_x:5,x:5,y:0,shape:[]};function q(){let e=P.shape;for(let t=0;t<e.length;t++)for(let o=0;o<e[t].length;o++)if(0!==e[t][o]&&u[P.y+t]&&0!==u[P.y+t][P.x+o])return!0;return!1}function D(){if(E=0,P.y+P.shape.length-1-G(P.shape)<0&&(P.x=P.start_x),P.x+P.shape.length-1-K(P.shape)>u[0].length-1&&(P.x=u[0].length-P.shape.length+K(P.shape)),P.x+Q(P.shape)<0&&(P.x=0-Q(P.shape)),P.y++,q()||P.y>u.length-P.shape.length+G(P.shape)){if(S+=C,P.y--,function(e,t){const o=e.shape;for(let r=0;r<o.length;r++)for(let n=0;n<o.length;n++)if(o[r][n]&&0!==o[r][n])try{t[e.y+r][e.x+n]=o[r][n]}catch(e){console.error(e)}}(P,u),function(e){let t=0;return e.forEach(e=>{t+=e}),t}(u[2])>0)return I(u,{x:0,y:0}),x=!0,void U(!1);B()}}function B(){P.shape=shapes[Math.round(Math.random()*(shapes.length-1))],P.y=-P.shape.length+G(P.shape),P.x=5-Math.round(P.shape.length/2),P.start_x=P.x,O=X}function H(e){const t=P.x;let o=1;for(L(P.shape,e);q();)if(P.x+=o,(o=-(o+(o>0?1:-1)))>P.shape[0].length)return L(P.shape,-e),void(P.x=t)}function G(e){let t=0;for(let o=e.length-1;o>=0;o--){for(let r=0;r<e[o].length;r++)if(0!==e[o][r])return t;t++}return t}function K(e){let t=0;for(let o=e.length-1;o>=0;o--){for(let r=0;r<e.length;r++)if(0!==e[r][o])return t;t++}return t}function Q(e){let t=0;for(let o=0;o<e.length;o++){for(let r=0;r<e.length;r++)if(0!==e[r][o])return t;t++}return t}function U(e){V=W=Z=!1,M(),x=!0,localStorage._end=JSON.stringify(x),localStorage._arena=JSON.stringify(J(h.width/c,h.height/c).slice(0)),e&&location.reload()}var V=!1,W=!1,Z=!1;function $(){W&&(S+=Y,D())}function ee(){V?(P.x--,q()&&P.x++):Z&&(P.x++,q()&&P.x--)}function te(e){if(x)U(!0);else{if(w)return;if("keydown"==e.type)switch(e.keyCode){case 87:case 38:H(1);break;case 65:case 37:if(P.y+P.shape.length-G(P.shape)<0)break;V=!0;break;case 83:case 40:W=!0;break;case 68:case 39:if(P.y+P.shape.length-G(P.shape)<0)break;Z=!0}else if("keyup"==e.type)switch(e.keyCode){case 65:case 37:V=!1;break;case 83:case 40:W=!1;break;case 68:case 39:Z=!1}}}}]);